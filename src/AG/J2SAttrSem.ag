module {AG.J2SAttrSem}
{} -- Exports of this module, empty for none
{
import Data.List
import qualified Data.Text as T
import Data.String.Utils
}
include "Syntax.ag"

-- ------------------------------------------------
-- Import Declaration
-- ------------------------------------------------
attr TypeName PackageOrTypeName
    syn importDeclarationList :: {[String]}

attr ImportDeclaration ImportDeclarations
    syn scalaImportDeclaration :: String

sem TypeName
    | TypeName lhs.importDeclarationList = @identifier : @typeName.importDeclarationList
    | NilTypeName lhs.importDeclarationList = []

sem PackageOrTypeName
    | NilPackageOrTypeName  lhs.importDeclarationList = []
    | PackageOrTypeName lhs.importDeclarationList = @identifier : @packageOrTypeName.importDeclarationList

sem ImportDeclaration
    | SingleTypeImportDeclaration lhs.scalaImportDeclaration =
        "import" ++ " " ++ foldl (\x y -> (if x == "" then y else x ++ "." ++ y)) ("") @typeName.importDeclarationList
    | TypeImportOnDemandDeclaration lhs.scalaImportDeclaration =
        "import" ++ " " ++
        foldl (\x y -> (if x == "" then y else x ++ "." ++ y)) ("") @packageOrTypeName.importDeclarationList ++
        "._"
    | SingleStaticImportDeclaration lhs.scalaImportDeclaration =
        "import" ++ " " ++ foldl (\x y -> (if x == "" then y else x ++ "." ++ y)) ("") @typeName.importDeclarationList
    | StaticImportOnDemandDeclaration lhs.scalaImportDeclaration =
        "import" ++ " " ++ foldl (\x y -> (if x == "" then y else x ++ "." ++ y)) ("") @typeName.importDeclarationList ++
        "._"

sem ImportDeclarations
    | ImportDeclarations lhs.scalaImportDeclaration =
        @importDeclaration.scalaImportDeclaration ++ "\n" ++ @importDeclarations.scalaImportDeclaration
    | NilImportDeclarations  lhs.scalaImportDeclaration = ""

-- ------------------------------------------------
-- Package declaration
-- ------------------------------------------------
set ScalaPackageDeclaration = PackageDeclaration

attr ScalaPackageDeclaration
    syn scalaPackageDeclaration :: String

attr PackageName
    syn scalaPackageDeclarationList :: {[String]}

sem PackageDeclaration
    | PackageDeclaration lhs.scalaPackageDeclaration =
        "package " ++ foldl (\x y -> (if x == "" then y else x ++ "." ++ y)) ("") @packageName.scalaPackageDeclarationList ++ "\n"
    | NilPackageDeclaration lhs.scalaPackageDeclaration = "\n"

sem PackageName
    | Nil  lhs.scalaPackageDeclarationList = []
    | Cons lhs.scalaPackageDeclarationList = @hd : @tl.scalaPackageDeclarationList

-- ------------------------------------------------
-- Type declarations
-- ------------------------------------------------
set ScalaAllNTab = ClassBodyDeclaration
                         VariableDeclarators
                         VariableDeclarator
                         VariableDeclaratorId VariableDeclaratorIdZ
                         VariableInitializer
                         VariableInitializers

set ScalaAllTypeDeclaration = TypeDeclarations TypeDeclaration
                            TypeParameters TypeParameterList TypeParameter TypeBound
                            ZCOITTypeDeclSpecifier ZClassOrInterfaceType ClassOrInterfaceType
                            Super
                            Interfaces
                            ClassBodyDeclarations ClassBodyDeclaration

attr ScalaAllTypeDeclaration
     syn scalaTypeDeclaration :: String

set ScalaFieldDeclaration = ClassBodyDeclaration VariableDeclarators VariableDeclarator
                         VariableDeclaratorId VariableDeclaratorIdZ
                         VariableInitializer
                         VariableInitializers
                         Type
                         PrimitiveOrReferenceType
                         ReferenceType
                         Modifiers
                         Modifier

attr ScalaAllNTab
    chn scalaNTab :: String

-- modifiers type variableName
{
    -- Modifier isStatic isFinal
type TypeModifierIsStaticIsFinal = (String, Bool, Bool)
-- Modifiers Types Variables
type TypeFieldDeclaration = ([TypeModifierIsStaticIsFinal], String, String)
}
attr ScalaFieldDeclaration
    chn scalaFieldDeclaration :: {[TypeFieldDeclaration]}

-- ------------------------------------------------
-- NormalClassDeclaration
-- ------------------------------------------------

set ScalaNormalClassDeclaration = Modifiers
                                Modifier

set ScalaSuperTypeDeclaration = ClassOrInterfaceType
                              ZClassOrInterfaceType
                              ZCOITTypeDeclSpecifier

set ScalaImplementsInterfaceTypeDeclaration =  InterfaceTypeList ClassOrInterfaceType
                                            ZClassOrInterfaceType
                                            ZCOITTypeDeclSpecifier

attr ScalaNormalClassDeclaration
    chn scalaNormalClassDeclaration :: TypeModifierIsStaticIsFinal

attr ScalaSuperTypeDeclaration
    syn scalaSuperTypeDeclaration :: String

attr ScalaImplementsInterfaceTypeDeclaration
    syn scalaImplementsInterfaceTypeDeclaration :: String

-- ------------------------------------------------
-- NormalInterfaceDeclaration
-- ------------------------------------------------
set ScalaNormalInterfaceDeclaration = Modifiers
                                    Modifier

set ScalaExtendInterface = ExtendsInterfaces
                          ClassOrInterfaceType
                          ZClassOrInterfaceType
                          ZCOITTypeDeclSpecifier

attr ScalaNormalInterfaceDeclaration
    chn scalaNormalInterfaceDeclaration :: TypeModifierIsStaticIsFinal

attr ScalaExtendInterface
    syn scalaExtendInterface ::  String

-- -----------------------------------------------
-- sem Type declarations
-- ------------------------------------------------
{
-- modifiers of normalClassDeclaration
normalClassDeclaration :: TypeModifierIsStaticIsFinal -> String
normalClassDeclaration ("", False, b2) = "class" ++ " "
normalClassDeclaration ("", True, b2) = "object" ++ " "
normalClassDeclaration (str, b1, b2) = if b1 then
                                            str ++ " " ++ "object" ++ " "
                                       else
                                            str ++ " " ++ "class" ++ " "
}

{
-- modifiers of normalinterfaceDeclaration
normalInterfaceDeclaration :: TypeModifierIsStaticIsFinal -> String
normalInterfaceDeclaration ("", False, b2) = "trait" ++ " "
normalInterfaceDeclaration ("", True, b2) = "object" ++ " "
normalInterfaceDeclaration (str, b1, b2) = if b1 then
                                                str ++ " " ++ "object" ++ " "
                                            else
                                                str ++ " " ++ "trait" ++ " "

}

sem TypeDeclarations
    | Cons lhs.scalaTypeDeclaration = @hd.scalaTypeDeclaration ++ "\n" ++ @tl.scalaTypeDeclaration
    | Nil  lhs.scalaTypeDeclaration = ""

sem TypeDeclaration
    | TypeDeclarationClassDeclarationNormalCD
                              modifiers.scalaFieldDeclaration = []
                              modifiers.scalaNormalClassDeclaration = ("", False, False)
                              modifiers.scalaNormalInterfaceDeclaration = ("", False, False)

                              lhs.scalaTypeDeclaration =
                                  (normalClassDeclaration @modifiers.scalaNormalClassDeclaration) ++
                                  @identifier ++
                                  @typeParameters.scalaTypeDeclaration ++ -- ToDo
                                  @super.scalaTypeDeclaration ++
                                  @interfaces.scalaTypeDeclaration ++
                                  " { " ++ @classBodyDeclarations.scalaTypeDeclaration ++ "\n} \n"

    | TypeDeclarationClassDeclarationEnumD
                                modifiers.scalaFieldDeclaration = []
                                lhs.scalaTypeDeclaration = "" -- ToDO modifiers :: Modifiers

                                modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                                modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | TypeDeclarationInterfaceDeclarationNormalInterfaceD
                                modifiers.scalaFieldDeclaration = []

                                lhs.scalaTypeDeclaration =
                                    (normalInterfaceDeclaration @modifiers.scalaNormalInterfaceDeclaration) ++
                                    @identifier ++
                                    @typeParameters.scalaTypeDeclaration ++ --ToDo
                                    @extendsInterfaces.scalaExtendInterface ++
                                    " { " ++  "\n} \n" --ToDo Body es listInterfaceMemberDeclaration

                                modifiers.scalaNormalClassDeclaration = ("", False, False)

                                modifiers.scalaNormalInterfaceDeclaration = ("", False, False)

                                -- modifiers :: Modifiers
                                -- identifier :: Identifier
                                -- typeParameters :: TypeParameters
                                -- extendsInterfaces :: ExtendsInterfaces
                                -- listInterfaceMemberDeclaration :: ListInterfaceMemberDeclaration

    | TypeDeclarationInterfaceDeclarationAnnotationTypeD
                                modifiers.scalaFieldDeclaration = []
                                lhs.scalaTypeDeclaration = "" -- ToDO  modifiers :: Modifiers

                                modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                                modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | TypeDeclarationSemiColon  lhs.scalaTypeDeclaration = "" -- ToDO review how to convert this case to Scala



sem ExtendsInterfaces
    | ExtendsInterfaceType
                lhs.scalaExtendInterface =  @classOrInterfacesType.scalaExtendInterface ++ @extendsInterfaces.scalaExtendInterface
    | NilExtendsInterfaces
                lhs.scalaExtendInterface = ""

{
concatenateModifiers :: [TypeFieldDeclaration] -> TypeFieldDeclaration -> [TypeFieldDeclaration]
concatenateModifiers [] tpl = tpl:[]
concatenateModifiers ((f,s,t):[]) (ftpl, stpl, ttpl) = ((ftpl ++ f), s, t):[]

changeOrderVolatileTransient :: [TypeFieldDeclaration] -> [TypeFieldDeclaration]
changeOrderVolatileTransient modifiers = map (\tdf -> partition' tdf) modifiers
    where
        partition' (ms, t, v) =  ((joinTuple (partition (\(m, _, _) -> (m == "@volatile" || m == "@transient")) ms)), t, v)
        joinTuple (fst, snd) = fst ++ snd
}

{
-- modifiers functions for normalClassDeclaration.
strictFpModifier :: TypeModifierIsStaticIsFinal -> TypeModifierIsStaticIsFinal
strictFpModifier (str, b1, b2) = if T.isInfixOf (T.pack("strfp")) (T.pack(str))
                                then ("@scala.annotation.strictfp\n" ++ T.unpack(T.strip(T.pack(replace "strfp" "" str))), b1, b2)
                                else (T.unpack(T.strip(T.pack(str))), b1, b2)

joinTypeModifier :: TypeModifierIsStaticIsFinal -> TypeModifierIsStaticIsFinal -> TypeModifierIsStaticIsFinal
joinTypeModifier ("", b1, b11) (str2, b2, b22) = (T.unpack(T.strip(T.pack(str2))), b1 || b2, b11 || b22)
joinTypeModifier (str1, b1, b11) ("", b2, b22) = (T.unpack(T.strip(T.pack(str1))), b1 || b2, b11 || b22)
joinTypeModifier (str1, b1, b11) (str2, b2, b22) = (T.unpack(T.strip(T.pack(str1))) ++  " " ++ T.unpack(T.strip(T.pack(str2))), b1 || b2, b11 || b22)

}

sem Modifiers
    | Modifiers
                    modifier.scalaFieldDeclaration = @lhs.scalaFieldDeclaration
                    modifiers.scalaFieldDeclaration = @modifier.scalaFieldDeclaration
                    lhs.scalaFieldDeclaration = changeOrderVolatileTransient @modifiers.scalaFieldDeclaration   -- ToDO check static final, etc

                    modifier.scalaNormalClassDeclaration = @lhs.scalaNormalClassDeclaration
                    modifiers.scalaNormalClassDeclaration = @modifier.scalaNormalClassDeclaration
                    lhs.scalaNormalClassDeclaration = strictFpModifier @modifiers.scalaNormalClassDeclaration

                    modifier.scalaNormalInterfaceDeclaration = @lhs.scalaNormalInterfaceDeclaration
                    modifiers.scalaNormalInterfaceDeclaration = @modifier.scalaNormalInterfaceDeclaration
                    lhs.scalaNormalInterfaceDeclaration = strictFpModifier @modifiers.scalaNormalInterfaceDeclaration

    | NilModifiers  lhs.scalaFieldDeclaration = changeOrderVolatileTransient @lhs.scalaFieldDeclaration

                    lhs.scalaNormalClassDeclaration = @lhs.scalaNormalClassDeclaration

                    lhs.scalaNormalInterfaceDeclaration = @lhs.scalaNormalInterfaceDeclaration

sem Modifier
    | ModifierAnnotation lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", False, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO annotation :: Annotation

                         lhs.scalaNormalClassDeclaration = @lhs.scalaNormalClassDeclaration -- ToDO annotation :: Annotation

                         lhs.scalaNormalInterfaceDeclaration =  @lhs.scalaNormalInterfaceDeclaration -- ToDo
    | ModifierPublic lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", False, False)], "", ""): @lhs.scalaFieldDeclaration)}

                     lhs.scalaNormalClassDeclaration = joinTypeModifier @lhs.scalaNormalClassDeclaration ("", False, False)

                     lhs.scalaNormalInterfaceDeclaration = joinTypeModifier @lhs.scalaNormalInterfaceDeclaration ("", False, False)
    | ModifierProtected lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("protected", False, False)], "", ""): @lhs.scalaFieldDeclaration)}

                        lhs.scalaNormalClassDeclaration = joinTypeModifier  @lhs.scalaNormalClassDeclaration  ("protected", False, False)

                        lhs.scalaNormalInterfaceDeclaration = joinTypeModifier @lhs.scalaNormalInterfaceDeclaration ("protected", False, False)
    | ModifierPrivate lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("private", False, False)], "", ""): @lhs.scalaFieldDeclaration)}

                      lhs.scalaNormalClassDeclaration = joinTypeModifier  @lhs.scalaNormalClassDeclaration ("private", False, False)

                      lhs.scalaNormalInterfaceDeclaration = joinTypeModifier @lhs.scalaNormalInterfaceDeclaration ("private", False, False)
    | ModifierAbstract lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", False, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO

                       lhs.scalaNormalClassDeclaration = joinTypeModifier  @lhs.scalaNormalClassDeclaration ("abstract", False, False)

                       lhs.scalaNormalInterfaceDeclaration = joinTypeModifier @lhs.scalaNormalInterfaceDeclaration ("abstract", False, False)
    | ModifiersStatic lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", True, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDo

                      lhs.scalaNormalClassDeclaration = joinTypeModifier  @lhs.scalaNormalClassDeclaration ("", True, False)

                      lhs.scalaNormalInterfaceDeclaration = joinTypeModifier @lhs.scalaNormalInterfaceDeclaration ("", True, False)
    | ModifierFinal lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", False, True)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO

                    lhs.scalaNormalClassDeclaration = joinTypeModifier  @lhs.scalaNormalClassDeclaration ("final", False, True)

                    lhs.scalaNormalInterfaceDeclaration = joinTypeModifier @lhs.scalaNormalInterfaceDeclaration ("", False, True)
    | ModifierStrictfp lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", False, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO

                        lhs.scalaNormalClassDeclaration = joinTypeModifier  @lhs.scalaNormalClassDeclaration ("strfp", False, False)

                        lhs.scalaNormalInterfaceDeclaration = joinTypeModifier @lhs.scalaNormalInterfaceDeclaration ("strfp", False, False)
    | FieldModifierTransient lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("@transient", False, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO

                             lhs.scalaNormalClassDeclaration = @lhs.scalaNormalClassDeclaration

                             lhs.scalaNormalInterfaceDeclaration = @lhs.scalaNormalInterfaceDeclaration
    | FieldModifierVolatile lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("@volatile", False, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO

                            lhs.scalaNormalClassDeclaration = @lhs.scalaNormalClassDeclaration

                            lhs.scalaNormalInterfaceDeclaration = @lhs.scalaNormalInterfaceDeclaration
    | MethodModifierSynchronized lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", False, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO

                                 lhs.scalaNormalClassDeclaration = @lhs.scalaNormalClassDeclaration

                                 lhs.scalaNormalInterfaceDeclaration = @lhs.scalaNormalInterfaceDeclaration
    | MethodModifierNative lhs.scalaFieldDeclaration = {foldl concatenateModifiers [] (([("", False, False)], "", ""): @lhs.scalaFieldDeclaration)} -- ToDO

                           lhs.scalaNormalClassDeclaration = @lhs.scalaNormalClassDeclaration

                           lhs.scalaNormalInterfaceDeclaration = @lhs.scalaNormalInterfaceDeclaration

sem TypeParameters
    | TypeParametersC1 lhs.scalaTypeDeclaration = "[" ++ @typeParameterList.scalaTypeDeclaration ++ "]" -- ToDO check >>>
    | TypeParametersC2 lhs.scalaTypeDeclaration = "[" ++ @typeParameterList.scalaTypeDeclaration ++ "]" -- ToDO check >>
    | TypeParametersC3 lhs.scalaTypeDeclaration = "[" ++ @typeParameterList.scalaTypeDeclaration ++ "]" -- ToDO check >
    | TypeParametersC0 lhs.scalaTypeDeclaration = "[" ++ @typeParameterList.scalaTypeDeclaration ++ "]" -- ToDO
    | NilTypeParameters lhs.scalaTypeDeclaration = ""

{
commaTypeParameters :: String -> String -> String
commaTypeParameters hd "" = hd
commaTypeParameters hd tl = hd ++ ", " ++ tl
}

sem TypeParameterList
    | Cons lhs.scalaTypeDeclaration = commaTypeParameters @hd.scalaTypeDeclaration @tl.scalaTypeDeclaration
    | Nil lhs.scalaTypeDeclaration = ""

sem TypeParameter
    | TypeParameterBound lhs.scalaTypeDeclaration = @identifier ++ @typeBound.scalaTypeDeclaration
    | TypeParameter lhs.scalaTypeDeclaration = @identifier

{
typeBoundInterface :: String -> String
typeBoundInterface str = replace "<:" "with" str
}

sem TypeBound
    | TypeBound lhs.scalaTypeDeclaration =  " <: " ++ @classOrInterfaceType.scalaTypeDeclaration ++ (typeBoundInterface @typeBound.scalaTypeDeclaration)
    | NilAdditionalBoundList lhs.scalaTypeDeclaration = ""

sem ClassOrInterfaceType
    | ClassOrInterfaceType lhs.scalaTypeDeclaration =  @identifier ++ @zClassOrInterfaceType.scalaTypeDeclaration -- used in typeArguments of normal class ToDo @typeArguments.scalaTypeDeclaration ++
                           lhs.scalaSuperTypeDeclaration = " extends " ++ @identifier ++ @zClassOrInterfaceType.scalaSuperTypeDeclaration -- used in Super
                           lhs.scalaImplementsInterfaceTypeDeclaration = @identifier ++ @zClassOrInterfaceType.scalaImplementsInterfaceTypeDeclaration
                           lhs.scalaExtendInterface = " extends " ++ @identifier ++ @zClassOrInterfaceType.scalaExtendInterface

sem ZClassOrInterfaceType
    | Cons lhs.scalaTypeDeclaration = @hd.scalaTypeDeclaration ++ @tl.scalaTypeDeclaration

           lhs.scalaSuperTypeDeclaration = "." ++ @hd.scalaSuperTypeDeclaration ++ @tl.scalaSuperTypeDeclaration

           lhs.scalaImplementsInterfaceTypeDeclaration = "." ++ @hd.scalaImplementsInterfaceTypeDeclaration ++ @tl.scalaImplementsInterfaceTypeDeclaration

           lhs.scalaExtendInterface =  "." ++ @hd.scalaExtendInterface ++ @tl.scalaExtendInterface

    | Nil lhs.scalaTypeDeclaration = ""
          lhs.scalaSuperTypeDeclaration = ""
          lhs.scalaImplementsInterfaceTypeDeclaration = ""
          lhs.scalaExtendInterface = ""

sem ZCOITTypeDeclSpecifier
    | ZCOITTypeDeclSpecifier lhs.scalaTypeDeclaration = @identifier -- ToDo ++ @typeArguments.scalaTypeDeclaration
                             lhs.scalaSuperTypeDeclaration = @identifier -- ToDo ++ @typeArguments.scalaTypeDeclaration
                             lhs.scalaImplementsInterfaceTypeDeclaration = @identifier
                             lhs.scalaExtendInterface = @identifier

sem Super
    | Super lhs.scalaTypeDeclaration = @classOrInterfaceType.scalaSuperTypeDeclaration
    | NilSuper lhs.scalaTypeDeclaration = ""

sem Interfaces
    | Interfaces lhs.scalaTypeDeclaration = @interfaceTypeList.scalaImplementsInterfaceTypeDeclaration   -- ToDO interfaceTypeList :: InterfaceTypeList
    | NilInterfaces lhs.scalaTypeDeclaration = ""

sem InterfaceTypeList
    | Cons lhs.scalaImplementsInterfaceTypeDeclaration = " with " ++ @hd.scalaImplementsInterfaceTypeDeclaration ++ @tl.scalaImplementsInterfaceTypeDeclaration
    | Nil lhs.scalaImplementsInterfaceTypeDeclaration = ""

sem ClassBodyDeclarations
    | Cons
            hd.scalaFieldDeclaration = []
            lhs.scalaTypeDeclaration = @hd.scalaTypeDeclaration ++ @tl.scalaTypeDeclaration
            hd.scalaNTab = ""
    | Nil
            lhs.scalaTypeDeclaration = ""


sem ReferenceTypeList
    | Cons  hd.scalaFieldDeclaration = []

{
checkVariableDeclarators :: [TypeFieldDeclaration] -> String -> String
checkVariableDeclarators [] _ = ""
checkVariableDeclarators ((modifiers, type_, variable):xs)  nTab
            | elemStaticFinal modifiers = "\n" ++ nTab ++ (takeModifiers modifiers) ++ "val "  ++ variable ++ ": " ++ (defaultValueType type_) ++  (checkVariableDeclarators xs nTab)
            | elemStatic modifiers = "\n" ++ nTab ++ (takeModifiers modifiers) ++  "var "  ++ variable ++ ": " ++ (defaultValueType type_) ++  (checkVariableDeclarators xs nTab)
            | elemFinal modifiers = "\n" ++ nTab ++(takeModifiers modifiers) ++ "val "  ++ variable ++ ": " ++ (defaultValueType type_) ++  (checkVariableDeclarators xs nTab)
            | otherwise  = "\n" ++ nTab ++ (takeModifiers modifiers) ++ "var "  ++ variable ++ ": " ++ (defaultValueType type_) ++  (checkVariableDeclarators xs nTab)

elemStatic :: [TypeModifierIsStaticIsFinal] -> Bool
elemStatic [] = False
elemStatic ((_, True, _):modifiers) = True  || elemStatic modifiers
elemStatic (m:modifiers)            = False || elemStatic modifiers

elemFinal :: [TypeModifierIsStaticIsFinal] -> Bool
elemFinal [] = False
elemFinal ((_, _, True):modifiers) = True  || elemFinal modifiers
elemFinal (m:modifiers)            = False || elemFinal modifiers

elemStaticFinal :: [TypeModifierIsStaticIsFinal] -> Bool
elemStaticFinal modifiers = (elemStatic modifiers) && (elemFinal modifiers)

takeModifiers :: [TypeModifierIsStaticIsFinal] -> String
takeModifiers modifiers = foldl takeModifiers' "" modifiers
    where
        takeModifiers' s (fs, t1, t2) = if (fs == "") then s else s ++ fs ++ " "

defaultValueType :: String -> String
defaultValueType type_
            | type_ == "Byte"    = type_ ++ " = 0"
            | type_ == "Short"   = type_ ++ " = 0"
            | type_ == "Int"     = type_ ++ " = 0"
            | type_ == "Long"    = type_ ++ " = 0L"
            | type_ == "Float"   = type_ ++ " = 0"
            | type_ == "Double"  = type_ ++ " = 0.0"
            | type_ == "Char"    = type_ ++ " = \'\\u0000\'"
            | type_ == "Boolean" = type_ ++ " = false"
            | otherwise          = type_ ++ " = null"
}

sem ClassBodyDeclaration
    | ClassBodyDeclClassMemberDeclFieldDeclaration
                        modifiers.scalaFieldDeclaration = @lhs.scalaFieldDeclaration
                        type_.scalaFieldDeclaration = @modifiers.scalaFieldDeclaration
                        variableDeclarators.scalaFieldDeclaration = @type_.scalaFieldDeclaration
                        lhs.scalaTypeDeclaration = {checkVariableDeclarators @variableDeclarators.scalaFieldDeclaration @variableDeclarators.scalaNTab}
                        variableDeclarators.scalaNTab = @lhs.scalaNTab
                        lhs.scalaNTab = @variableDeclarators.scalaNTab

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | ClassBodyDeclClassMemberDeclMethodDeclaration
                        modifiers.scalaFieldDeclaration = []
                        lhs.scalaTypeDeclaration = ""

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | ClassBodyDeclClassMemberDeclClassDeclarationNormalCD
                        lhs.scalaFieldDeclaration = []  -- ToDO              modifiers :: Modifiers
                        lhs.scalaTypeDeclaration = ""

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | ClassBodyDeclClassMemberDeclClassDeclarationEnumD
                        lhs.scalaFieldDeclaration = [] -- ToDO                 modifiers :: Modifiers
                        lhs.scalaTypeDeclaration = ""

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | ClassBodyDeclClassMemberDeclInterfaceDeclarationNormalInterfaceD
                        lhs.scalaFieldDeclaration = [] -- ToDO modifiers :: Modifiers
                        lhs.scalaTypeDeclaration = ""

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | ClassBodyDeclClassMemberDeclInterfaceDeclarationAnnotationTypeD
                        lhs.scalaFieldDeclaration = [] -- ToDO modifiers :: Modifiers
                        lhs.scalaTypeDeclaration = ""

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | ClassBodyDeclClassMemberDeclSemiColon
                        lhs.scalaFieldDeclaration = [] -- ToDO
                        lhs.scalaTypeDeclaration = ""
    | ClassBodyInstanceInitializer
                        lhs.scalaFieldDeclaration = [] -- ToDO  blockStatements :: BlockStatements {- Block -- InstanceInitializer -}
                        lhs.scalaTypeDeclaration = ""
    | ClassBodyStaticInitializer
                        lhs.scalaFieldDeclaration = [] -- ToDO  blockStatements :: BlockStatements {- StaticInitializer -}
                        lhs.scalaTypeDeclaration = ""
    | ClassBodyConstructorDeclaration
                        lhs.scalaFieldDeclaration = [] -- ToDO  modifiers :: Modifiers
                        lhs.scalaTypeDeclaration = ""

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | ClassBodyConstructorDeclarationNoFormalParList
                        lhs.scalaFieldDeclaration = [] -- ToDO  modifiers :: Modifiers
                        lhs.scalaTypeDeclaration = ""

                        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

                        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo

sem Type  -- ToDo check
    | TypePrimitiveType lhs.scalaFieldDeclaration = @primitiveOrReferenceType.scalaFieldDeclaration

{
addTypeToModifiers :: String -> TypeFieldDeclaration -> TypeFieldDeclaration
addTypeToModifiers type_ (modifiers, t, variableDeclarators)  = (modifiers, type_, variableDeclarators)
}

sem PrimitiveOrReferenceType
    | TypePrimitiveNumericType_TypeIntegral_Byte
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Byte") @lhs.scalaFieldDeclaration
    | TypePrimitiveNumericType_TypeIntegral_Short
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Short") @lhs.scalaFieldDeclaration -- ToDo
    | TypePrimitiveNumericType_TypeIntegral_Int
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Int") @lhs.scalaFieldDeclaration -- ToDo
    | TypePrimitiveNumericType_TypeIntegral_Long
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Long") @lhs.scalaFieldDeclaration -- ToDo
    | TypePrimitiveNumericType_TypeIntegral_Char
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Char") @lhs.scalaFieldDeclaration -- ToDo
    | TypePrimitiveNumericType_TypeFloating_Float
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Float") @lhs.scalaFieldDeclaration -- ToDo
    | TypePrimitiveNumericType_TypeFloating_Double
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Double") @lhs.scalaFieldDeclaration -- ToDo
    | TypePrimitivePrimitivetypeBoolean
                                lhs.scalaFieldDeclaration = map (addTypeToModifiers "Boolean") @lhs.scalaFieldDeclaration -- ToDo
    | TypeReference
                                lhs.scalaFieldDeclaration = @referenceType.scalaFieldDeclaration -- ToDo

sem ReferenceType
    | ReferenceTypeClassOrInterfaceType  lhs.scalaFieldDeclaration =  map (addTypeToModifiers @identifier) @lhs.scalaFieldDeclaration -- ToDo
                                        -- ToDO typeArguments :: TypeArguments
                                        -- ToDO zClassOrInterfaceType :: ZClassOrInterfaceType
sem VariableDeclarators
    | Cons lhs.scalaFieldDeclaration = @hd.scalaFieldDeclaration ++ @tl.scalaFieldDeclaration

           hd.scalaNTab = @lhs.scalaNTab
           tl.scalaNTab = @lhs.scalaNTab
           lhs.scalaNTab = @hd.scalaNTab
    | Nil  lhs.scalaFieldDeclaration  = []
           lhs.scalaNTab = @lhs.scalaNTab


sem VariableDeclaratorId
    | VarDeclaratorId
        lhs.scalaFieldDeclaration = { foldl (\x (fs, tp, _) -> ((fs, tp, @identifier): x))    ([]::[TypeFieldDeclaration]) @lhs.scalaFieldDeclaration }
        lhs.scalaNTab= @lhs.scalaNTab ++ "\t"
    | VarDeclaratorIdVDZ
        lhs.scalaFieldDeclaration = { (foldl (\x (fs, tp, _) -> ((fs, tp, @identifier): x)) ([]::[TypeFieldDeclaration]) @lhs.scalaFieldDeclaration) ++
            @variableDeclaratorIdZ.scalaFieldDeclaration
        }
        lhs.scalaNTab = @lhs.scalaNTab ++ "\t"

sem ResultType
    | ResultTypeType type_.scalaFieldDeclaration = []

sem FormalParameterList
    | FormalParameterListFormal
                                type_.scalaFieldDeclaration = []
                                variableDeclaratorId.scalaFieldDeclaration = []
                                variableDeclaratorId.scalaNTab = ""

    | FormalParameterListLast
                                type_.scalaFieldDeclaration = []
                                variableDeclaratorId.scalaFieldDeclaration = []
                                variableDeclaratorId.scalaNTab = ""

sem ForStatement
    | ForStatementEnhancedForStatementNoVarModif type_.scalaFieldDeclaration = []
    | ForStatementEnhancedForStatement type_.scalaFieldDeclaration = []

sem ForInit
    | ForInitLocalVar
        type_.scalaFieldDeclaration = []
        variableDeclarators.scalaNTab = ""

sem WildcardBounds
    | WilcardBoundsExtendsReferenceType type_.scalaFieldDeclaration = []
    | WilcardBoundsSuperReferenceType type_.scalaFieldDeclaration = []

sem InterfaceMemberDeclaration
    | InterfaceMemberDeclarationConstant
        modifiers.scalaFieldDeclaration = []
        type_.scalaFieldDeclaration = []
        variableDeclarators.scalaFieldDeclaration = []
        variableDeclarators.scalaNTab = ""

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | InterfaceMemberDeclarationAbstract
        modifiers.scalaFieldDeclaration = []

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | InterfaceMemberDeclTypeDeclarationClassDeclarationNormalCD
        modifiers.scalaFieldDeclaration = []

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | InterfaceMemberDeclTypeDeclarationClassDeclarationEnumD
        modifiers.scalaFieldDeclaration = []

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | InterfaceMemberDeclTypeDeclarationInterfaceDeclarationNormalInterfaceD
        modifiers.scalaFieldDeclaration = []

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | InterfaceMemberDeclTypeDeclarationInterfaceDeclarationAnnotationTypeD
        modifiers.scalaFieldDeclaration = []

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo

sem ConditionalOrExpression
    | ConditionalOrExpressionIntanceOf
            type_.scalaFieldDeclaration = []

sem CatchClause
    | CatchClause
        type_.scalaFieldDeclaration = []
        variableDeclaratorId.scalaNTab = ""

sem BlockStatement
    | BlockStatementLocalVariableDeclarationStatement
        modifiers.scalaFieldDeclaration = [] -- ToDo
        type_.scalaFieldDeclaration = [] -- ToDo
        variableDeclarators.scalaNTab = ""

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | BlockStatementClassDeclarationNormalClassDeclaration
        modifiers.scalaFieldDeclaration = [] -- ToDo

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | BlockStatementClassDeclarationEnumDeclaration
        modifiers.scalaFieldDeclaration = [] -- ToDo

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo

sem ArrayInitializer
    | ArrayInitializer
        variableInitializers.scalaFieldDeclaration = [] -- ToDo
        variableInitializers.scalaNTab = "" -- ToDo

sem AnnotationTypeElementDeclaration
    | AnnTypeElemDeclAbstract
        modifiers.scalaFieldDeclaration = [] -- ToDo
        type_.scalaFieldDeclaration = [] -- ToDo

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | AnnTypeElemDeclConstant
        modifiers.scalaFieldDeclaration = [] -- ToDo
        type_.scalaFieldDeclaration = [] -- ToDo
        variableDeclarators.scalaNTab = "" -- ToDo check if is neccesary for parent

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | AnnTypeElemDeclTypeDeclarationClassDeclarationNormalCD
        modifiers.scalaFieldDeclaration = [] -- ToDo

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | AnnTypeElemDeclTypeDeclarationClassDeclarationEnumD
        modifiers.scalaFieldDeclaration = [] -- ToDo

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | AnnTypeElemDeclTypeDeclarationInterfaceDeclarationNormalInterfaceD
        modifiers.scalaFieldDeclaration = [] -- ToDo

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo
    | AnnTypeElemDeclTypeDeclarationInterfaceDeclarationAnnotationTypeD
        modifiers.scalaFieldDeclaration = [] -- ToDo

        modifiers.scalaNormalClassDeclaration = ("", False, False) -- ToDo

        modifiers.scalaNormalInterfaceDeclaration = ("", False, False) -- ToDo

sem ActualTypeArgument
    | ActualTypeReferenceType type_.scalaFieldDeclaration = [] -- ToDo

-- ------------------------------------------------
-- J2S scala code
-- ------------------------------------------------
attr J2s
     syn scalaCode :: String

sem J2s
    | J2s lhs.scalaCode = @packageDeclaration.scalaPackageDeclaration ++
                          @importDeclarations.scalaImportDeclaration ++
                          @typeDeclarations.scalaTypeDeclaration
